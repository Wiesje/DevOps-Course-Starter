script:
- docker build --target test --tag my-test-image .
- docker run my-test-image tests
- docker run -e TRELLO_API_KEY -e TRELLO_API_SECRET -e TRELLO_BOARD_ID my-test-image
  tests_e2e

before_deploy:
- docker build --target prod --tag wiehee/todo-app-devops-course:$TRAVIS_COMMIT --tag registry.heroku.com/todo-app-devops-course/web .
- echo $DOCKER_HUB_PASSWORD | docker login --username $DOCKER_HUB_USERNAME --password-stdin
- echo $HEROKU_API_KEY | docker login --username $HEROKU_USERNAME --password-stdin registry.heroku.com

deploy:
  provider: script
  script:
  - docker push wiehee/todo-app-devops-course:$TRAVIS_COMMIT &&
    docker push registry.heroku.com/todo-app-devops-course/web &&
    heroku container:release web -a todo-app-devops-course
  on:
    branch: master
env:
  global:
  - HEROKU_USERNAME=wiehee
  - secure: c47wQCrJKj9HYS7WtPKXTNJDCONvDLVB1FnzHVi6OXzaHiuzHSJORsmy7mfzs2fSGuXQk+itLT6SMSNGyZUihpxCq75N8Jk6Ye8e6bJW0nDd/3GlsCdroMeqBC3HE6W2pYpcRdrsDJ7A9Yctk1904ZkcjH629Gm+u7t4Li8HRjzPHJ9uUuNIIrh/F1oMhc94Hqn4lXrK+eJuGzrAv01lpm7rcaDPXqAlp+KDgkH7g1pkNooCB1C1G2z7dwisTO9dHGQH3MxvNcpAhfQnT2Ui54ypcT5UuF6VlbJyKIveSWxduAIdQBgXnImKTtoiwbE+EYy5lBsTim6NBeyxg7iQ2tSolFtnHIEKTRrw3/yCDmTMiAa/G89JOFf5L1gXmZoHLOncChWMeOf3vHLwmtPHjFG7Z6F+LscdKJ8QOcKmo1UaqdGvC9WrW/SNz2l5gESQNPrM2naFVdXZgFlDQpuDxkPrM5I7C2dvoY8YBT6jTF06x9UuD4PLox3YQhj1sA56sRHc/V50JSLbOw8O7cxiYR19PwNAdAf5rzsUwiVVFavHopb6TAGdpQmAc6UKEWHIAQFcwbgYk7hfZz1Yh+ujrP3bFsgsIxuE27mFVpqu6KDG0MYtCUW9pk066nXVtsbpdcaIL9xV/doYjsBJJcbLy0qG+CYYicfbijrgYT34fhI=
  - secure: WpKlZ+Da8tC5smphjJLGDzFg0p68e95SACrZWwu5nnCddzTkfsNrenZ8X+DiKLUy0o5QzV59EbwfzaKnfNAcGjLUCZiFBsFPK0kAH5koAnSunw04DDBnz/nHcEUh3IfA0Ks/C1cmx0RCXds1yvKzeoigOqf+OwZVPvX7tBb4aGooAtoNUqvvnvCzHfjtVeN9iUGX+QbYRVYDUTyJlgyGESu+rLc7hGczVFzBtO/MC0+Tlu8hoKW8PU76kcuUV3NAwuudiSRzh1LkdXL0Im5QGZe3oA1viZoFaBOBnhI+4Cev99yDjgw7IWMcVmAx+zGiI+oDcrU1veDVD0sg2APzrKqcrXMig6XjD1m1cWHq9PjBwTNT1dA9IvjnppXhH0/ym5LwVf3MHvLQINHG5qU0Xtga/9qeLO8+nhsOlyIeg3HGhSBFpzmB3uWxYUJgUbVlXwn8ZpywB1SzcYci914PW5z/+UNFrKWrfkfXZRaigvU8E6Cv4zXV9Lae6MOdue28Tes5BQFZaeTCwtEUeBHeSl2t4GFS3rtPA0rVYuMqS8H+71caijz2qub59iGdDTod4LthaZX68+DJVEl5J/BRPrn8CX9bqP8QZ/eFvg9OE5MZyHArUgdq4K0Mn+xSovHcNx8FTTlB2oyfPAAcQ1eMJXsZk8ZE6GivWbxiRqKZp/4=
  - secure: dR/96djVp17xIoWu9GmKtuqCL/3dvgavMkp6isk5A8Tit2ZtmiJrvrxMLZFzgURMLQb04li+P0/gbymRqCqHb9ySOUV0x87YoXMhBCMVrZuVETJysS4MShNGKKT6lWOzbAuRnJ11YNIKqG2+UAcmWJQsY5E5/guv8UggB7e45Uzrsdqq/41pykA6IZo+n7EzlzIZ6hYG1fqt65WqfXp/d9XeYvWKh9+5V37F7toaNrxjRIOYx2knVFwWRA73ZWCoNHNeuyys8jINEQmNIrZyKsNy2jgiuYLzS752q8YPIxy5c6RB0kvq7zNCOhqthrc1juFGutpM5j0LrAeoIhwwo0Dm/OFfstu/mkwLtFxNyxSblkDh+OYNVJlPSLM9uVdpcMgduWLEdYhFfMNoM2wSqLCzU40/JzxgjsVu/idf0NUWRrsHphc8TQgyZmTLsj8xzeD9Wj4Y07Fq7CrIcbb89BJPFe7ZPGNocCTmaOz/3QVXctFxff6c/qvx8EGiwWS81NHh803svtkXcdjAd3SV81gMLUeYbq6kpXrdZuRljkiKdU1hyCmWdSRG51rZ7TuvNMPaWl6IXOu/iMy5YIF5EgeHGAnxVxS7BIFIEbImioCi22UMv0h5XUKb8puoqrodL9aSaMdXt4MYwVwxYKeVMl6ZsdIPK6i5Ow0sp55ir1c=
  - secure: NheqCTKPL1+pN83nOZyeXPeJmj+Y25xFXwYFi1bnhry8ah9OtrZyj39NHrvHt/u2jPL3F91Kg/hSTTVtWWZ6yGXup0bmtafYz2erm8DoVcMWHLSNyc+kPmQjdyVJIPJc66UHz2fZWl2gr/JeOWRU/hbEju+q09vMLNZwkl0TtfxZtYdjj7v/Rea6pPd4qKe0xsnt54xU08FF2opmixlhh6cHIGjX2LOcCPdOweCHy29nBVTfEouAFYh7PvB5YT3rJnKUqgsXHXKxwUn6rkLu+EoLFSd33IZwSsTPZXdVrzgK1umMAZY7CVtFFlh++8duiyl6Cxuyrjl466r2wO/6XzfbE7yqmVCBWFy8cptPYPPa2vbAQKqqKvqJ0/zCpOmnD5sjgKGQg4t3CoOq535Sip+E7AS7pytm62cvgH36iFz6R6o9Ab5w2kp3hdIqIfJfAAunQGropS8FTE4ZBJ8htQz1+zdVHrN35Yummsu8vTLuo9UOCZ27cxNJslE1aFWP/ogxujX6WySzMtWIAR3DkYQe4QR04KSRtVypimvNv2R1ituK5Y7D/fBZZInTADI0vViCJ7MC3pDG8MDIUWCFyGuy8VepRSzT4prsEnO0kXLP1ZU3NH7Yh7pnIObrg+aMwwGvFHsiI7qrj8cBaJMm9sbKg15jxQ7O/UVzQMA36CU=
  - secure: KEeaFL0n4fwHDll7SVg/7SfJKtux7rwZkGJrSzhGcLS1RTNJFZOoPGYGMd/Rqt4QV+MGo6EOo9r6EY7YhFRLwE95mNjGqsL8Licea83thYjLbDAtysK62WO5kSvE8uhd5PJCx2vC9026crUh1F6umo5pXSqiThZc3vXzIwijKCxpoUbx6z9ULhcTE1eaQiV5wQCl2eQ64YNKrZtj1czr0MlNGDH0592caPtKC7QKbJErINPPTFaTEeR6c23uAkLz33dMGdq+dJ81mCwxOQQj/WNh9YvtLX4O9A1luA4MNd1tnKoAiYBvoc78iD8wYD5LC1Wc7fZjxa8818qOxHVxSKP96haWRHKaY6ZozRi3ozPv98eJfweJ2Fg9akm0m/6oGDczsjWJ4M95QqTkVtyLtb2eehDxWWfyAwQ0v87xM5PtmpzONnenrWLzas6zaqxk62st369rh/hxI2VgLwo4TE5mjjo/e3v+33sVVo8j4/khXjpMZZsf04suYdoU5aIhhoobBGD8g4qkqcZMgwwgZ9f1PGXFe7x238GRL7Erw8tq1nvlbMl4+UnbXDuQX8BVW1hdGO2cX3SUTqBA69FpJFv70L7iq/pDWQISO8rded+O0JFwSOMo4jUShh2pmLbg6hoW084523uEqvsRAiy4LBdzyl48cQFjB96VrgvSWXg=
  - secure: dPsS92a1HOLFWB0bPvIutVDwb7+MKkkE3855gFJY22sDSZHcYzaPjozxjPnLs5J14HwpkpRT93PU4KoMLKturI7KQa4pxUx5sObD2+osLVsskIjuGCsTYIqSduOFJF4Ou6yChhmDO/xhd+5e6aGF4IU1s23C4G1oq3AkKqSe3SgIGVhABuPksETLU8JEVCz9IDjNSQAX7yFIIr9Ea3AJenYpZfeX2Vo24aAUbabAs6PeQmB+8HKab82/PRdODSu1YUzUoGqAkhHuWsLPWJRy1QRjrNFNeqeFkheyFcfbzui6VhpaueYK3D9eBCditdT8PhGaSdO7ladtJWA8+kpc4mfUprxLgdkCzEs/mxhVNgvhFh4wedHh3hHsF+bAnXwQT96NyrJ1iQ1UTfTG7ndO/a6AVcKC1N9q0f+rEZEKhxzmcVgnFHvTNy3A7CYhEXr5mcC5Arqz+u1vyyU8pcYZlBsmhQC23vzbsTdBueF+9YSVf0KJVGluBr/Jk6d777FDmKcUXOt89+DDVOy7EyrKA+DsnEJKkeSxEao8dlkmx1xvfoGUC1iWjT67tWeEyJxIluuYcjnVOEDtn981qq1AtwQ4ekA4x4sJKVOs+zU6eI1P/S9tANqh9Idhpmjai7Zy2ZsGz6rEQbePp7RvQPI5mimTn6vsYYIsXpASu5t8JeE=
